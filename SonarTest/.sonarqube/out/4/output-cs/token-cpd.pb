ù3
i/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Identity/IdentityService.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Identity# +
;+ ,
public		 
class		 
IdentityService		 
:		 
IIdentityService		 /
{

 
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private 
readonly '
IUserClaimsPrincipalFactory 0
<0 1
ApplicationUser1 @
>@ A'
_userClaimsPrincipalFactoryB ]
;] ^
private 
readonly !
IAuthorizationService *!
_authorizationService+ @
;@ A
public 

IdentityService 
( 
UserManager 
< 
ApplicationUser #
># $
userManager% 0
,0 1'
IUserClaimsPrincipalFactory #
<# $
ApplicationUser$ 3
>3 4&
userClaimsPrincipalFactory5 O
,O P!
IAuthorizationService  
authorizationService 2
)2 3
{ 
_userManager 
= 
userManager "
;" #'
_userClaimsPrincipalFactory #
=$ %&
userClaimsPrincipalFactory& @
;@ A!
_authorizationService 
=  
authorizationService  4
;4 5
} 
public 

async 
Task 
< 
string 
? 
> 
GetUserNameAsync /
(/ 0
string0 6
userId7 =
)= >
{ 
var 
user 
= 
await 
_userManager %
.% &
FindByIdAsync& 3
(3 4
userId4 :
): ;
;; <
return 
user 
? 
. 
UserName 
; 
} 
public   

async   
Task   
<   
(   
Result   
Result   $
,  $ %
string  & ,
UserId  - 3
)  3 4
>  4 5
CreateUserAsync  6 E
(  E F
string  F L
userName  M U
,  U V
string  W ]
password  ^ f
)  f g
{!! 
var"" 
user"" 
="" 
new"" 
ApplicationUser"" &
{## 	
UserName$$ 
=$$ 
userName$$ 
,$$  
Email%% 
=%% 
userName%% 
,%% 
}&& 	
;&&	 

var(( 
result(( 
=(( 
await(( 
_userManager(( '
.((' (
CreateAsync((( 3
(((3 4
user((4 8
,((8 9
password((: B
)((B C
;((C D
return** 
(** 
result** 
.** 
ToApplicationResult** *
(*** +
)**+ ,
,**, -
user**. 2
.**2 3
Id**3 5
)**5 6
;**6 7
}++ 
public-- 

async-- 
Task-- 
<-- 
bool-- 
>-- 
IsInRoleAsync-- )
(--) *
string--* 0
userId--1 7
,--7 8
string--9 ?
role--@ D
)--D E
{.. 
var// 
user// 
=// 
await// 
_userManager// %
.//% &
FindByIdAsync//& 3
(//3 4
userId//4 :
)//: ;
;//; <
return11 
user11 
!=11 
null11 
&&11 
await11 $
_userManager11% 1
.111 2
IsInRoleAsync112 ?
(11? @
user11@ D
,11D E
role11F J
)11J K
;11K L
}22 
public44 

async44 
Task44 
<44 
bool44 
>44 
AuthorizeAsync44 *
(44* +
string44+ 1
userId442 8
,448 9
string44: @

policyName44A K
)44K L
{55 
var66 
user66 
=66 
await66 
_userManager66 %
.66% &
FindByIdAsync66& 3
(663 4
userId664 :
)66: ;
;66; <
if88 

(88 
user88 
==88 
null88 
)88 
{99 	
return:: 
false:: 
;:: 
};; 	
var== 
	principal== 
=== 
await== '
_userClaimsPrincipalFactory== 9
.==9 :
CreateAsync==: E
(==E F
user==F J
)==J K
;==K L
var?? 
result?? 
=?? 
await?? !
_authorizationService?? 0
.??0 1
AuthorizeAsync??1 ?
(??? @
	principal??@ I
,??I J

policyName??K U
)??U V
;??V W
returnAA 
resultAA 
.AA 
	SucceededAA 
;AA  
}BB 
publicDD 

asyncDD 
TaskDD 
<DD 
ResultDD 
>DD 
DeleteUserAsyncDD -
(DD- .
stringDD. 4
userIdDD5 ;
)DD; <
{EE 
varFF 
userFF 
=FF 
awaitFF 
_userManagerFF %
.FF% &
FindByIdAsyncFF& 3
(FF3 4
userIdFF4 :
)FF: ;
;FF; <
returnHH 
userHH 
!=HH 
nullHH 
?HH 
awaitHH #
DeleteUserAsyncHH$ 3
(HH3 4
userHH4 8
)HH8 9
:HH: ;
ResultHH< B
.HHB C
SuccessHHC J
(HHJ K
)HHK L
;HHL M
}II 
publicKK 

asyncKK 
TaskKK 
<KK 
ResultKK 
>KK 
DeleteUserAsyncKK -
(KK- .
ApplicationUserKK. =
userKK> B
)KKB C
{LL 
varMM 
resultMM 
=MM 
awaitMM 
_userManagerMM '
.MM' (
DeleteAsyncMM( 3
(MM3 4
userMM4 8
)MM8 9
;MM9 :
returnOO 
resultOO 
.OO 
ToApplicationResultOO )
(OO) *
)OO* +
;OO+ ,
}PP 
}QQ È
r/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Identity/IdentityResultExtensions.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Identity# +
;+ ,
public 
static 
class $
IdentityResultExtensions ,
{ 
public 

static 
Result 
ToApplicationResult ,
(, -
this- 1
IdentityResult2 @
resultA G
)G H
{		 
return

 
result

 
.

 
	Succeeded

 
? 
Result 
. 
Success 
( 
) 
: 
Result 
. 
Failure 
( 
result #
.# $
Errors$ *
.* +
Select+ 1
(1 2
e2 3
=>4 6
e7 8
.8 9
Description9 D
)D E
)E F
;F G
} 
} û
i/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Identity/ApplicationUser.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Identity# +
;+ ,
public 
class 
ApplicationUser 
: 
IdentityUser +
{ 
} _
]/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/GlobalUsings.cs¤$
d/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/DependencyInjection.cs
	namespace 	
	Microsoft
 
. 

Extensions 
. 
DependencyInjection 2
;2 3
public 
static 
class 
DependencyInjection '
{ 
public 

static 
IServiceCollection $%
AddInfrastructureServices% >
(> ?
this? C
IServiceCollectionD V
servicesW _
,_ `
IConfiguration 
configuration $
)$ %
{ 
var 
connectionString 
= 
configuration ,
., -
GetConnectionString- @
(@ A
$strA T
)T U
;U V
Guard 
. 
Against 
. 
Null 
( 
connectionString +
,+ ,
message- 4
:4 5
$str6 h
)h i
;i j
services 
. 
	AddScoped 
< #
ISaveChangesInterceptor 2
,2 3&
AuditableEntityInterceptor4 N
>N O
(O P
)P Q
;Q R
services 
. 
	AddScoped 
< #
ISaveChangesInterceptor 2
,2 3+
DispatchDomainEventsInterceptor4 S
>S T
(T U
)U V
;V W
services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
(4 5
sp5 7
,7 8
options9 @
)@ A
=>B D
{ 	
options 
. 
AddInterceptors #
(# $
sp$ &
.& '
GetServices' 2
<2 3#
ISaveChangesInterceptor3 J
>J K
(K L
)L M
)M N
;N O
options 
. 
	UseSqlite 
( 
connectionString .
). /
;/ 0
} 	
)	 

;
 
services   
.   
	AddScoped   
<   !
IApplicationDbContext   0
>  0 1
(  1 2
provider  2 :
=>  ; =
provider  > F
.  F G
GetRequiredService  G Y
<  Y Z 
ApplicationDbContext  Z n
>  n o
(  o p
)  p q
)  q r
;  r s
services"" 
."" 
	AddScoped"" 
<"" +
ApplicationDbContextInitialiser"" :
>"": ;
(""; <
)""< =
;""= >
services$$ 
.$$ 
AddAuthentication$$ "
($$" #
)$$# $
.%% 
AddBearerToken%% 
(%% 
IdentityConstants%% -
.%%- .
BearerScheme%%. :
)%%: ;
;%%; <
services'' 
.'' #
AddAuthorizationBuilder'' (
(''( )
)'') *
;''* +
services)) 
.** 
AddIdentityCore** 
<** 
ApplicationUser** ,
>**, -
(**- .
)**. /
.++ 
AddRoles++ 
<++ 
IdentityRole++ "
>++" #
(++# $
)++$ %
.,, $
AddEntityFrameworkStores,, %
<,,% & 
ApplicationDbContext,,& :
>,,: ;
(,,; <
),,< =
.-- 
AddApiEndpoints-- 
(-- 
)-- 
;-- 
services// 
.// 
AddSingleton// 
(// 
TimeProvider// *
.//* +
System//+ 1
)//1 2
;//2 3
services00 
.00 
AddTransient00 
<00 
IIdentityService00 .
,00. /
IdentityService000 ?
>00? @
(00@ A
)00A B
;00B C
services22 
.22 
AddAuthorization22 !
(22! "
options22" )
=>22* ,
options33 
.33 
	AddPolicy33 
(33 
Policies33 &
.33& '
CanPurge33' /
,33/ 0
policy331 7
=>338 :
policy33; A
.33A B
RequireRole33B M
(33M N
Roles33N S
.33S T
Administrator33T a
)33a b
)33b c
)33c d
;33d e
return55 
services55 
;55 
}66 
}77 Û
}/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Data/Migrations/00000000000000_InitialCreate.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Data# '
.' (

Migrations( 2
{ 
public		 

partial		 
class		 
InitialCreate		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
type. 2
:2 3
$str4 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
trueX \
)\ ]
,] ^
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
type: >
:> ?
$str@ F
,F G
	maxLengthH Q
:Q R
$numS V
,V W
nullableX `
:` a
trueb f
)f g
,g h
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
type< @
:@ A
$strB H
,H I
nullableJ R
:R S
trueT X
)X Y
} 
, 
constraints 
: 
table "
=># %
{& '
table( -
.- .

PrimaryKey. 8
(8 9
$str9 I
,I J
xK L
=>M O
xP Q
.Q R
IdR T
)T U
;U V
}W X
)X Y
;Y Z
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
type. 2
:2 3
$str4 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
	maxLengthB K
:K L
$numM P
,P Q
nullableR Z
:Z [
true\ `
)` a
,a b
NormalizedUserName &
=' (
table) .
.. /
Column/ 5
<5 6
string6 <
>< =
(= >
type> B
:B C
$strD J
,J K
	maxLengthL U
:U V
$numW Z
,Z [
nullable\ d
:d e
truef j
)j k
,k l
Email   
=   
table   !
.  ! "
Column  " (
<  ( )
string  ) /
>  / 0
(  0 1
type  1 5
:  5 6
$str  7 =
,  = >
	maxLength  ? H
:  H I
$num  J M
,  M N
nullable  O W
:  W X
true  Y ]
)  ] ^
,  ^ _
NormalizedEmail!! #
=!!$ %
table!!& +
.!!+ ,
Column!!, 2
<!!2 3
string!!3 9
>!!9 :
(!!: ;
type!!; ?
:!!? @
$str!!A G
,!!G H
	maxLength!!I R
:!!R S
$num!!T W
,!!W X
nullable!!Y a
:!!a b
true!!c g
)!!g h
,!!h i
EmailConfirmed"" "
=""# $
table""% *
.""* +
Column""+ 1
<""1 2
bool""2 6
>""6 7
(""7 8
type""8 <
:""< =
$str""> G
,""G H
nullable""I Q
:""Q R
false""S X
)""X Y
,""Y Z
PasswordHash##  
=##! "
table### (
.##( )
Column##) /
<##/ 0
string##0 6
>##6 7
(##7 8
type##8 <
:##< =
$str##> D
,##D E
nullable##F N
:##N O
true##P T
)##T U
,##U V
SecurityStamp$$ !
=$$" #
table$$$ )
.$$) *
Column$$* 0
<$$0 1
string$$1 7
>$$7 8
($$8 9
type$$9 =
:$$= >
$str$$? E
,$$E F
nullable$$G O
:$$O P
true$$Q U
)$$U V
,$$V W
ConcurrencyStamp%% $
=%%% &
table%%' ,
.%%, -
Column%%- 3
<%%3 4
string%%4 :
>%%: ;
(%%; <
type%%< @
:%%@ A
$str%%B H
,%%H I
nullable%%J R
:%%R S
true%%T X
)%%X Y
,%%Y Z
PhoneNumber&& 
=&&  !
table&&" '
.&&' (
Column&&( .
<&&. /
string&&/ 5
>&&5 6
(&&6 7
type&&7 ;
:&&; <
$str&&= C
,&&C D
nullable&&E M
:&&M N
true&&O S
)&&S T
,&&T U 
PhoneNumberConfirmed'' (
='') *
table''+ 0
.''0 1
Column''1 7
<''7 8
bool''8 <
>''< =
(''= >
type''> B
:''B C
$str''D M
,''M N
nullable''O W
:''W X
false''Y ^
)''^ _
,''_ `
TwoFactorEnabled(( $
=((% &
table((' ,
.((, -
Column((- 3
<((3 4
bool((4 8
>((8 9
(((9 :
type((: >
:((> ?
$str((@ I
,((I J
nullable((K S
:((S T
false((U Z
)((Z [
,(([ \

LockoutEnd)) 
=))  
table))! &
.))& '
Column))' -
<))- .
DateTimeOffset)). <
>))< =
())= >
type))> B
:))B C
$str))D J
,))J K
nullable))L T
:))T U
true))V Z
)))Z [
,))[ \
LockoutEnabled** "
=**# $
table**% *
.*** +
Column**+ 1
<**1 2
bool**2 6
>**6 7
(**7 8
type**8 <
:**< =
$str**> G
,**G H
nullable**I Q
:**Q R
false**S X
)**X Y
,**Y Z
AccessFailedCount++ %
=++& '
table++( -
.++- .
Column++. 4
<++4 5
int++5 8
>++8 9
(++9 :
type++: >
:++> ?
$str++@ I
,++I J
nullable++K S
:++S T
false++U Z
)++Z [
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{--& '
table--( -
.--- .

PrimaryKey--. 8
(--8 9
$str--9 I
,--I J
x--K L
=>--M O
x--P Q
.--Q R
Id--R T
)--T U
;--U V
}--W X
)--X Y
;--Y Z
migrationBuilder// 
.// 
CreateTable// (
(//( )
name00 
:00 
$str00 !
,00! "
columns11 
:11 
table11 
=>11 !
new11" %
{22 
Id33 
=33 
table33 
.33 
Column33 %
<33% &
int33& )
>33) *
(33* +
type33+ /
:33/ 0
$str331 :
,33: ;
nullable33< D
:33D E
false33F K
)33K L
.44 

Annotation44 #
(44# $
$str44$ :
,44: ;
true44< @
)44@ A
,44A B
Title55 
=55 
table55 !
.55! "
Column55" (
<55( )
string55) /
>55/ 0
(550 1
type551 5
:555 6
$str557 =
,55= >
	maxLength55? H
:55H I
$num55J M
,55M N
nullable55O W
:55W X
false55Y ^
)55^ _
,55_ `
Colour_Code66 
=66  !
table66" '
.66' (
Column66( .
<66. /
string66/ 5
>665 6
(666 7
type667 ;
:66; <
$str66= C
,66C D
nullable66E M
:66M N
false66O T
)66T U
,66U V
Created77 
=77 
table77 #
.77# $
Column77$ *
<77* +
DateTimeOffset77+ 9
>779 :
(77: ;
type77; ?
:77? @
$str77A G
,77G H
nullable77I Q
:77Q R
false77S X
)77X Y
,77Y Z
	CreatedBy88 
=88 
table88  %
.88% &
Column88& ,
<88, -
string88- 3
>883 4
(884 5
type885 9
:889 :
$str88; A
,88A B
nullable88C K
:88K L
true88M Q
)88Q R
,88R S
LastModified99  
=99! "
table99# (
.99( )
Column99) /
<99/ 0
DateTimeOffset990 >
>99> ?
(99? @
type99@ D
:99D E
$str99F L
,99L M
nullable99N V
:99V W
false99X ]
)99] ^
,99^ _
LastModifiedBy:: "
=::# $
table::% *
.::* +
Column::+ 1
<::1 2
string::2 8
>::8 9
(::9 :
type::: >
:::> ?
$str::@ F
,::F G
nullable::H P
:::P Q
true::R V
)::V W
};; 
,;; 
constraints<< 
:<< 
table<< "
=><<# %
{<<& '
table<<( -
.<<- .

PrimaryKey<<. 8
(<<8 9
$str<<9 G
,<<G H
x<<I J
=><<K M
x<<N O
.<<O P
Id<<P R
)<<R S
;<<S T
}<<U V
)<<V W
;<<W X
migrationBuilder>> 
.>> 
CreateTable>> (
(>>( )
name?? 
:?? 
$str?? (
,??( )
columns@@ 
:@@ 
table@@ 
=>@@ !
new@@" %
{AA 
IdBB 
=BB 
tableBB 
.BB 
ColumnBB %
<BB% &
intBB& )
>BB) *
(BB* +
typeBB+ /
:BB/ 0
$strBB1 :
,BB: ;
nullableBB< D
:BBD E
falseBBF K
)BBK L
.CC 

AnnotationCC #
(CC# $
$strCC$ :
,CC: ;
trueCC< @
)CC@ A
,CCA B
RoleIdDD 
=DD 
tableDD "
.DD" #
ColumnDD# )
<DD) *
stringDD* 0
>DD0 1
(DD1 2
typeDD2 6
:DD6 7
$strDD8 >
,DD> ?
nullableDD@ H
:DDH I
falseDDJ O
)DDO P
,DDP Q
	ClaimTypeEE 
=EE 
tableEE  %
.EE% &
ColumnEE& ,
<EE, -
stringEE- 3
>EE3 4
(EE4 5
typeEE5 9
:EE9 :
$strEE; A
,EEA B
nullableEEC K
:EEK L
trueEEM Q
)EEQ R
,EER S

ClaimValueFF 
=FF  
tableFF! &
.FF& '
ColumnFF' -
<FF- .
stringFF. 4
>FF4 5
(FF5 6
typeFF6 :
:FF: ;
$strFF< B
,FFB C
nullableFFD L
:FFL M
trueFFN R
)FFR S
}GG 
,GG 
constraintsHH 
:HH 
tableHH "
=>HH# %
{II 
tableJJ 
.JJ 

PrimaryKeyJJ $
(JJ$ %
$strJJ% :
,JJ: ;
xJJ< =
=>JJ> @
xJJA B
.JJB C
IdJJC E
)JJE F
;JJF G
tableKK 
.KK 

ForeignKeyKK $
(KK$ %
nameLL 
:LL 
$strLL F
,LLF G
columnMM 
:MM 
xMM  !
=>MM" $
xMM% &
.MM& '
RoleIdMM' -
,MM- .
principalTableNN &
:NN& '
$strNN( 5
,NN5 6
principalColumnOO '
:OO' (
$strOO) -
,OO- .
onDeletePP  
:PP  !
ReferentialActionPP" 3
.PP3 4
CascadePP4 ;
)PP; <
;PP< =
}QQ 
)QQ 
;QQ 
migrationBuilderSS 
.SS 
CreateTableSS (
(SS( )
nameTT 
:TT 
$strTT (
,TT( )
columnsUU 
:UU 
tableUU 
=>UU !
newUU" %
{VV 
IdWW 
=WW 
tableWW 
.WW 
ColumnWW %
<WW% &
intWW& )
>WW) *
(WW* +
typeWW+ /
:WW/ 0
$strWW1 :
,WW: ;
nullableWW< D
:WWD E
falseWWF K
)WWK L
.XX 

AnnotationXX #
(XX# $
$strXX$ :
,XX: ;
trueXX< @
)XX@ A
,XXA B
UserIdYY 
=YY 
tableYY "
.YY" #
ColumnYY# )
<YY) *
stringYY* 0
>YY0 1
(YY1 2
typeYY2 6
:YY6 7
$strYY8 >
,YY> ?
nullableYY@ H
:YYH I
falseYYJ O
)YYO P
,YYP Q
	ClaimTypeZZ 
=ZZ 
tableZZ  %
.ZZ% &
ColumnZZ& ,
<ZZ, -
stringZZ- 3
>ZZ3 4
(ZZ4 5
typeZZ5 9
:ZZ9 :
$strZZ; A
,ZZA B
nullableZZC K
:ZZK L
trueZZM Q
)ZZQ R
,ZZR S

ClaimValue[[ 
=[[  
table[[! &
.[[& '
Column[[' -
<[[- .
string[[. 4
>[[4 5
([[5 6
type[[6 :
:[[: ;
$str[[< B
,[[B C
nullable[[D L
:[[L M
true[[N R
)[[R S
}\\ 
,\\ 
constraints]] 
:]] 
table]] "
=>]]# %
{^^ 
table__ 
.__ 

PrimaryKey__ $
(__$ %
$str__% :
,__: ;
x__< =
=>__> @
x__A B
.__B C
Id__C E
)__E F
;__F G
table`` 
.`` 

ForeignKey`` $
(``$ %
nameaa 
:aa 
$straa F
,aaF G
columnbb 
:bb 
xbb  !
=>bb" $
xbb% &
.bb& '
UserIdbb' -
,bb- .
principalTablecc &
:cc& '
$strcc( 5
,cc5 6
principalColumndd '
:dd' (
$strdd) -
,dd- .
onDeleteee  
:ee  !
ReferentialActionee" 3
.ee3 4
Cascadeee4 ;
)ee; <
;ee< =
}ff 
)ff 
;ff 
migrationBuilderhh 
.hh 
CreateTablehh (
(hh( )
nameii 
:ii 
$strii (
,ii( )
columnsjj 
:jj 
tablejj 
=>jj !
newjj" %
{kk 
LoginProviderll !
=ll" #
tablell$ )
.ll) *
Columnll* 0
<ll0 1
stringll1 7
>ll7 8
(ll8 9
typell9 =
:ll= >
$strll? E
,llE F
nullablellG O
:llO P
falsellQ V
)llV W
,llW X
ProviderKeymm 
=mm  !
tablemm" '
.mm' (
Columnmm( .
<mm. /
stringmm/ 5
>mm5 6
(mm6 7
typemm7 ;
:mm; <
$strmm= C
,mmC D
nullablemmE M
:mmM N
falsemmO T
)mmT U
,mmU V
ProviderDisplayNamenn '
=nn( )
tablenn* /
.nn/ 0
Columnnn0 6
<nn6 7
stringnn7 =
>nn= >
(nn> ?
typenn? C
:nnC D
$strnnE K
,nnK L
nullablennM U
:nnU V
truennW [
)nn[ \
,nn\ ]
UserIdoo 
=oo 
tableoo "
.oo" #
Columnoo# )
<oo) *
stringoo* 0
>oo0 1
(oo1 2
typeoo2 6
:oo6 7
$stroo8 >
,oo> ?
nullableoo@ H
:ooH I
falseooJ O
)ooO P
}pp 
,pp 
constraintsqq 
:qq 
tableqq "
=>qq# %
{rr 
tabless 
.ss 

PrimaryKeyss $
(ss$ %
$strss% :
,ss: ;
xss< =
=>ss> @
newssA D
{ssE F
xssG H
.ssH I
LoginProviderssI V
,ssV W
xssX Y
.ssY Z
ProviderKeyssZ e
}ssf g
)ssg h
;ssh i
tablett 
.tt 

ForeignKeytt $
(tt$ %
nameuu 
:uu 
$struu F
,uuF G
columnvv 
:vv 
xvv  !
=>vv" $
xvv% &
.vv& '
UserIdvv' -
,vv- .
principalTableww &
:ww& '
$strww( 5
,ww5 6
principalColumnxx '
:xx' (
$strxx) -
,xx- .
onDeleteyy  
:yy  !
ReferentialActionyy" 3
.yy3 4
Cascadeyy4 ;
)yy; <
;yy< =
}zz 
)zz 
;zz 
migrationBuilder|| 
.|| 
CreateTable|| (
(||( )
name}} 
:}} 
$str}} '
,}}' (
columns~~ 
:~~ 
table~~ 
=>~~ !
new~~" %
{ 
UserId
 
=
 
table
 "
.
" #
Column
# )
<
) *
string
* 0
>
0 1
(
1 2
type
2 6
:
6 7
$str
8 >
,
> ?
nullable
@ H
:
H I
false
J O
)
O P
,
P Q
RoleId
 
=
 
table
 "
.
" #
Column
# )
<
) *
string
* 0
>
0 1
(
1 2
type
2 6
:
6 7
$str
8 >
,
> ?
nullable
@ H
:
H I
false
J O
)
O P
}
 
,
 
constraints
 
:
 
table
 "
=>
# %
{
 
table
 
.
 

PrimaryKey
 $
(
$ %
$str
% 9
,
9 :
x
; <
=>
= ?
new
@ C
{
D E
x
F G
.
G H
UserId
H N
,
N O
x
P Q
.
Q R
RoleId
R X
}
Y Z
)
Z [
;
[ \
table
 
.
 

ForeignKey
 $
(
$ %
name
 
:
 
$str
 E
,
E F
column
 
:
 
x
  !
=>
" $
x
% &
.
& '
RoleId
' -
,
- .
principalTable
 &
:
& '
$str
( 5
,
5 6
principalColumn
 '
:
' (
$str
) -
,
- .
onDelete
  
:
  !
ReferentialAction
" 3
.
3 4
Cascade
4 ;
)
; <
;
< =
table
 
.
 

ForeignKey
 $
(
$ %
name
 
:
 
$str
 E
,
E F
column
 
:
 
x
  !
=>
" $
x
% &
.
& '
UserId
' -
,
- .
principalTable
 &
:
& '
$str
( 5
,
5 6
principalColumn
 '
:
' (
$str
) -
,
- .
onDelete
  
:
  !
ReferentialAction
" 3
.
3 4
Cascade
4 ;
)
; <
;
< =
}
 
)
 
;
 
migrationBuilder
 
.
 
CreateTable
 (
(
( )
name
 
:
 
$str
 (
,
( )
columns
 
:
 
table
 
=>
 !
new
" %
{
 
UserId
 
=
 
table
 "
.
" #
Column
# )
<
) *
string
* 0
>
0 1
(
1 2
type
2 6
:
6 7
$str
8 >
,
> ?
nullable
@ H
:
H I
false
J O
)
O P
,
P Q
LoginProvider
 !
=
" #
table
$ )
.
) *
Column
* 0
<
0 1
string
1 7
>
7 8
(
8 9
type
9 =
:
= >
$str
? E
,
E F
nullable
G O
:
O P
false
Q V
)
V W
,
W X
Name
 
=
 
table
  
.
  !
Column
! '
<
' (
string
( .
>
. /
(
/ 0
type
0 4
:
4 5
$str
6 <
,
< =
nullable
> F
:
F G
false
H M
)
M N
,
N O
Value
 
=
 
table
 !
.
! "
Column
" (
<
( )
string
) /
>
/ 0
(
0 1
type
1 5
:
5 6
$str
7 =
,
= >
nullable
? G
:
G H
true
I M
)
M N
}
 
,
 
constraints
 
:
 
table
 "
=>
# %
{
 
table
 
.
 

PrimaryKey
 $
(
$ %
$str
% :
,
: ;
x
< =
=>
> @
new
A D
{
E F
x
G H
.
H I
UserId
I O
,
O P
x
Q R
.
R S
LoginProvider
S `
,
` a
x
b c
.
c d
Name
d h
}
i j
)
j k
;
k l
table
   
.
   

ForeignKey
   $
(
  $ %
name
¡¡ 
:
¡¡ 
$str
¡¡ F
,
¡¡F G
column
¢¢ 
:
¢¢ 
x
¢¢  !
=>
¢¢" $
x
¢¢% &
.
¢¢& '
UserId
¢¢' -
,
¢¢- .
principalTable
££ &
:
££& '
$str
££( 5
,
££5 6
principalColumn
¤¤ '
:
¤¤' (
$str
¤¤) -
,
¤¤- .
onDelete
¥¥  
:
¥¥  !
ReferentialAction
¥¥" 3
.
¥¥3 4
Cascade
¥¥4 ;
)
¥¥; <
;
¥¥< =
}
¦¦ 
)
¦¦ 
;
¦¦ 
migrationBuilder
¨¨ 
.
¨¨ 
CreateTable
¨¨ (
(
¨¨( )
name
©© 
:
©© 
$str
©© !
,
©©! "
columns
ªª 
:
ªª 
table
ªª 
=>
ªª !
new
ªª" %
{
«« 
Id
¬¬ 
=
¬¬ 
table
¬¬ 
.
¬¬ 
Column
¬¬ %
<
¬¬% &
int
¬¬& )
>
¬¬) *
(
¬¬* +
type
¬¬+ /
:
¬¬/ 0
$str
¬¬1 :
,
¬¬: ;
nullable
¬¬< D
:
¬¬D E
false
¬¬F K
)
¬¬K L
.
­­ 

Annotation
­­ #
(
­­# $
$str
­­$ :
,
­­: ;
true
­­< @
)
­­@ A
,
­­A B
ListId
®® 
=
®® 
table
®® "
.
®®" #
Column
®®# )
<
®®) *
int
®®* -
>
®®- .
(
®®. /
type
®®/ 3
:
®®3 4
$str
®®5 >
,
®®> ?
nullable
®®@ H
:
®®H I
false
®®J O
)
®®O P
,
®®P Q
Title
¯¯ 
=
¯¯ 
table
¯¯ !
.
¯¯! "
Column
¯¯" (
<
¯¯( )
string
¯¯) /
>
¯¯/ 0
(
¯¯0 1
type
¯¯1 5
:
¯¯5 6
$str
¯¯7 =
,
¯¯= >
	maxLength
¯¯? H
:
¯¯H I
$num
¯¯J M
,
¯¯M N
nullable
¯¯O W
:
¯¯W X
false
¯¯Y ^
)
¯¯^ _
,
¯¯_ `
Note
°° 
=
°° 
table
°°  
.
°°  !
Column
°°! '
<
°°' (
string
°°( .
>
°°. /
(
°°/ 0
type
°°0 4
:
°°4 5
$str
°°6 <
,
°°< =
nullable
°°> F
:
°°F G
true
°°H L
)
°°L M
,
°°M N
Priority
±± 
=
±± 
table
±± $
.
±±$ %
Column
±±% +
<
±±+ ,
int
±±, /
>
±±/ 0
(
±±0 1
type
±±1 5
:
±±5 6
$str
±±7 @
,
±±@ A
nullable
±±B J
:
±±J K
false
±±L Q
)
±±Q R
,
±±R S
Reminder
²² 
=
²² 
table
²² $
.
²²$ %
Column
²²% +
<
²²+ ,
DateTime
²², 4
>
²²4 5
(
²²5 6
type
²²6 :
:
²²: ;
$str
²²< B
,
²²B C
nullable
²²D L
:
²²L M
true
²²N R
)
²²R S
,
²²S T
Done
³³ 
=
³³ 
table
³³  
.
³³  !
Column
³³! '
<
³³' (
bool
³³( ,
>
³³, -
(
³³- .
type
³³. 2
:
³³2 3
$str
³³4 =
,
³³= >
nullable
³³? G
:
³³G H
false
³³I N
)
³³N O
,
³³O P
Created
´´ 
=
´´ 
table
´´ #
.
´´# $
Column
´´$ *
<
´´* +
DateTimeOffset
´´+ 9
>
´´9 :
(
´´: ;
type
´´; ?
:
´´? @
$str
´´A G
,
´´G H
nullable
´´I Q
:
´´Q R
false
´´S X
)
´´X Y
,
´´Y Z
	CreatedBy
µµ 
=
µµ 
table
µµ  %
.
µµ% &
Column
µµ& ,
<
µµ, -
string
µµ- 3
>
µµ3 4
(
µµ4 5
type
µµ5 9
:
µµ9 :
$str
µµ; A
,
µµA B
nullable
µµC K
:
µµK L
true
µµM Q
)
µµQ R
,
µµR S
LastModified
¶¶  
=
¶¶! "
table
¶¶# (
.
¶¶( )
Column
¶¶) /
<
¶¶/ 0
DateTimeOffset
¶¶0 >
>
¶¶> ?
(
¶¶? @
type
¶¶@ D
:
¶¶D E
$str
¶¶F L
,
¶¶L M
nullable
¶¶N V
:
¶¶V W
false
¶¶X ]
)
¶¶] ^
,
¶¶^ _
LastModifiedBy
·· "
=
··# $
table
··% *
.
··* +
Column
··+ 1
<
··1 2
string
··2 8
>
··8 9
(
··9 :
type
··: >
:
··> ?
$str
··@ F
,
··F G
nullable
··H P
:
··P Q
true
··R V
)
··V W
}
¸¸ 
,
¸¸ 
constraints
¹¹ 
:
¹¹ 
table
¹¹ "
=>
¹¹# %
{
ºº 
table
»» 
.
»» 

PrimaryKey
»» $
(
»»$ %
$str
»»% 3
,
»»3 4
x
»»5 6
=>
»»7 9
x
»»: ;
.
»»; <
Id
»»< >
)
»»> ?
;
»»? @
table
¼¼ 
.
¼¼ 

ForeignKey
¼¼ $
(
¼¼$ %
name
½½ 
:
½½ 
$str
½½ =
,
½½= >
column
¾¾ 
:
¾¾ 
x
¾¾  !
=>
¾¾" $
x
¾¾% &
.
¾¾& '
ListId
¾¾' -
,
¾¾- .
principalTable
¿¿ &
:
¿¿& '
$str
¿¿( 3
,
¿¿3 4
principalColumn
ÀÀ '
:
ÀÀ' (
$str
ÀÀ) -
,
ÀÀ- .
onDelete
ÁÁ  
:
ÁÁ  !
ReferentialAction
ÁÁ" 3
.
ÁÁ3 4
Cascade
ÁÁ4 ;
)
ÁÁ; <
;
ÁÁ< =
}
ÂÂ 
)
ÂÂ 
;
ÂÂ 
migrationBuilder
ÄÄ 
.
ÄÄ 
CreateIndex
ÄÄ (
(
ÄÄ( )
name
ÅÅ 
:
ÅÅ 
$str
ÅÅ 2
,
ÅÅ2 3
table
ÆÆ 
:
ÆÆ 
$str
ÆÆ )
,
ÆÆ) *
column
ÇÇ 
:
ÇÇ 
$str
ÇÇ  
)
ÇÇ  !
;
ÇÇ! "
migrationBuilder
ÉÉ 
.
ÉÉ 
CreateIndex
ÉÉ (
(
ÉÉ( )
name
ÊÊ 
:
ÊÊ 
$str
ÊÊ %
,
ÊÊ% &
table
ËË 
:
ËË 
$str
ËË $
,
ËË$ %
column
ÌÌ 
:
ÌÌ 
$str
ÌÌ (
,
ÌÌ( )
unique
ÍÍ 
:
ÍÍ 
true
ÍÍ 
)
ÍÍ 
;
ÍÍ 
migrationBuilder
ÏÏ 
.
ÏÏ 
CreateIndex
ÏÏ (
(
ÏÏ( )
name
ÐÐ 
:
ÐÐ 
$str
ÐÐ 2
,
ÐÐ2 3
table
ÑÑ 
:
ÑÑ 
$str
ÑÑ )
,
ÑÑ) *
column
ÒÒ 
:
ÒÒ 
$str
ÒÒ  
)
ÒÒ  !
;
ÒÒ! "
migrationBuilder
ÔÔ 
.
ÔÔ 
CreateIndex
ÔÔ (
(
ÔÔ( )
name
ÕÕ 
:
ÕÕ 
$str
ÕÕ 2
,
ÕÕ2 3
table
ÖÖ 
:
ÖÖ 
$str
ÖÖ )
,
ÖÖ) *
column
×× 
:
×× 
$str
××  
)
××  !
;
××! "
migrationBuilder
ÙÙ 
.
ÙÙ 
CreateIndex
ÙÙ (
(
ÙÙ( )
name
ÚÚ 
:
ÚÚ 
$str
ÚÚ 1
,
ÚÚ1 2
table
ÛÛ 
:
ÛÛ 
$str
ÛÛ (
,
ÛÛ( )
column
ÜÜ 
:
ÜÜ 
$str
ÜÜ  
)
ÜÜ  !
;
ÜÜ! "
migrationBuilder
ÞÞ 
.
ÞÞ 
CreateIndex
ÞÞ (
(
ÞÞ( )
name
ßß 
:
ßß 
$str
ßß "
,
ßß" #
table
àà 
:
àà 
$str
àà $
,
àà$ %
column
áá 
:
áá 
$str
áá )
)
áá) *
;
áá* +
migrationBuilder
ãã 
.
ãã 
CreateIndex
ãã (
(
ãã( )
name
ää 
:
ää 
$str
ää %
,
ää% &
table
åå 
:
åå 
$str
åå $
,
åå$ %
column
ææ 
:
ææ 
$str
ææ ,
,
ææ, -
unique
çç 
:
çç 
true
çç 
)
çç 
;
çç 
migrationBuilder
éé 
.
éé 
CreateIndex
éé (
(
éé( )
name
êê 
:
êê 
$str
êê +
,
êê+ ,
table
ëë 
:
ëë 
$str
ëë "
,
ëë" #
column
ìì 
:
ìì 
$str
ìì  
)
ìì  !
;
ìì! "
}
íí 	
	protected
ðð 
override
ðð 
void
ðð 
Down
ðð  $
(
ðð$ %
MigrationBuilder
ðð% 5
migrationBuilder
ðð6 F
)
ððF G
{
ññ 	
migrationBuilder
òò 
.
òò 
	DropTable
òò &
(
òò& '
name
óó 
:
óó 
$str
óó (
)
óó( )
;
óó) *
migrationBuilder
õõ 
.
õõ 
	DropTable
õõ &
(
õõ& '
name
öö 
:
öö 
$str
öö (
)
öö( )
;
öö) *
migrationBuilder
øø 
.
øø 
	DropTable
øø &
(
øø& '
name
ùù 
:
ùù 
$str
ùù (
)
ùù( )
;
ùù) *
migrationBuilder
ûû 
.
ûû 
	DropTable
ûû &
(
ûû& '
name
üü 
:
üü 
$str
üü '
)
üü' (
;
üü( )
migrationBuilder
þþ 
.
þþ 
	DropTable
þþ &
(
þþ& '
name
ÿÿ 
:
ÿÿ 
$str
ÿÿ (
)
ÿÿ( )
;
ÿÿ) *
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
 
:
 
$str
 !
)
! "
;
" #
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
 
:
 
$str
 #
)
# $
;
$ %
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
 
:
 
$str
 #
)
# $
;
$ %
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
 
:
 
$str
 !
)
! "
;
" #
}
 	
}
 
} #
/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Data/Interceptors/DispatchDomainEventsInterceptor.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Data# '
.' (
Interceptors( 4
;4 5
public 
class +
DispatchDomainEventsInterceptor ,
:- ."
SaveChangesInterceptor/ E
{		 
private

 
readonly

 
	IMediator

 
	_mediator

 (
;

( )
public 
+
DispatchDomainEventsInterceptor *
(* +
	IMediator+ 4
mediator5 =
)= >
{ 
	_mediator 
= 
mediator 
; 
} 
public 

override 
InterceptionResult &
<& '
int' *
>* +
SavingChanges, 9
(9 :
DbContextEventData: L
	eventDataM V
,V W
InterceptionResultX j
<j k
intk n
>n o
resultp v
)v w
{  
DispatchDomainEvents 
( 
	eventData &
.& '
Context' .
). /
./ 0

GetAwaiter0 :
(: ;
); <
.< =
	GetResult= F
(F G
)G H
;H I
return 
base 
. 
SavingChanges !
(! "
	eventData" +
,+ ,
result- 3
)3 4
;4 5
} 
public 

override 
async 
	ValueTask #
<# $
InterceptionResult$ 6
<6 7
int7 :
>: ;
>; <
SavingChangesAsync= O
(O P
DbContextEventDataP b
	eventDatac l
,l m
InterceptionResult 
< 
int 
> 
result  &
,& '
CancellationToken( 9
cancellationToken: K
=L M
defaultN U
)U V
{ 
await  
DispatchDomainEvents "
(" #
	eventData# ,
., -
Context- 4
)4 5
;5 6
return 
await 
base 
. 
SavingChangesAsync ,
(, -
	eventData- 6
,6 7
result8 >
,> ?
cancellationToken@ Q
)Q R
;R S
} 
public   

async   
Task    
DispatchDomainEvents   *
(  * +
	DbContext  + 4
?  4 5
context  6 =
)  = >
{!! 
if"" 

("" 
context"" 
=="" 
null"" 
)"" 
return"" #
;""# $
var$$ 
entities$$ 
=$$ 
context$$ 
.$$ 
ChangeTracker$$ ,
.%% 
Entries%% 
<%% 

BaseEntity%% 
>%%  
(%%  !
)%%! "
.&& 
Where&& 
(&& 
e&& 
=>&& 
e&& 
.&& 
Entity&&  
.&&  !
DomainEvents&&! -
.&&- .
Any&&. 1
(&&1 2
)&&2 3
)&&3 4
.'' 
Select'' 
('' 
e'' 
=>'' 
e'' 
.'' 
Entity'' !
)''! "
;''" #
var)) 
domainEvents)) 
=)) 
entities)) #
.** 

SelectMany** 
(** 
e** 
=>** 
e** 
.** 
DomainEvents** +
)**+ ,
.++ 
ToList++ 
(++ 
)++ 
;++ 
entities-- 
.-- 
ToList-- 
(-- 
)-- 
.-- 
ForEach-- !
(--! "
e--" #
=>--$ &
e--' (
.--( )
ClearDomainEvents--) :
(--: ;
)--; <
)--< =
;--= >
foreach// 
(// 
var// 
domainEvent//  
in//! #
domainEvents//$ 0
)//0 1
await00 
	_mediator00 
.00 
Publish00 #
(00# $
domainEvent00$ /
)00/ 0
;000 1
}11 
}22 ©-
}/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Data/Interceptors/AuditableEntityInterceptor.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Data# '
.' (
Interceptors( 4
;4 5
public		 
class		 &
AuditableEntityInterceptor		 '
:		( )"
SaveChangesInterceptor		* @
{

 
private 
readonly 
IUser 
_user  
;  !
private 
readonly 
TimeProvider !
	_dateTime" +
;+ ,
public 
&
AuditableEntityInterceptor %
(% &
IUser 
user 
, 
TimeProvider 
dateTime 
) 
{ 
_user 
= 
user 
; 
	_dateTime 
= 
dateTime 
; 
} 
public 

override 
InterceptionResult &
<& '
int' *
>* +
SavingChanges, 9
(9 :
DbContextEventData: L
	eventDataM V
,V W
InterceptionResultX j
<j k
intk n
>n o
resultp v
)v w
{ 
UpdateEntities 
( 
	eventData  
.  !
Context! (
)( )
;) *
return 
base 
. 
SavingChanges !
(! "
	eventData" +
,+ ,
result- 3
)3 4
;4 5
} 
public 

override 
	ValueTask 
< 
InterceptionResult 0
<0 1
int1 4
>4 5
>5 6
SavingChangesAsync7 I
(I J
DbContextEventDataJ \
	eventData] f
,f g
InterceptionResult 
< 
int 
> 
result  &
,& '
CancellationToken( 9
cancellationToken: K
=L M
defaultN U
)U V
{ 
UpdateEntities   
(   
	eventData    
.    !
Context  ! (
)  ( )
;  ) *
return"" 
base"" 
."" 
SavingChangesAsync"" &
(""& '
	eventData""' 0
,""0 1
result""2 8
,""8 9
cancellationToken"": K
)""K L
;""L M
}## 
public%% 

void%% 
UpdateEntities%% 
(%% 
	DbContext%% (
?%%( )
context%%* 1
)%%1 2
{&& 
if'' 

('' 
context'' 
=='' 
null'' 
)'' 
return'' #
;''# $
foreach)) 
()) 
var)) 
entry)) 
in)) 
context)) %
.))% &
ChangeTracker))& 3
.))3 4
Entries))4 ;
<)); <
BaseAuditableEntity))< O
>))O P
())P Q
)))Q R
)))R S
{** 	
if++ 
(++ 
entry++ 
.++ 
State++ 
is++ 
EntityState++ *
.++* +
Added+++ 0
or++1 3
EntityState++4 ?
.++? @
Modified++@ H
||++I K
entry++L Q
.++Q R#
HasChangedOwnedEntities++R i
(++i j
)++j k
)++k l
{,, 
var-- 
utcNow-- 
=-- 
	_dateTime-- &
.--& '
	GetUtcNow--' 0
(--0 1
)--1 2
;--2 3
if.. 
(.. 
entry.. 
... 
State.. 
==..  "
EntityState..# .
.... /
Added../ 4
)..4 5
{// 
entry00 
.00 
Entity00  
.00  !
	CreatedBy00! *
=00+ ,
_user00- 2
.002 3
Id003 5
;005 6
entry11 
.11 
Entity11  
.11  !
Created11! (
=11) *
utcNow11+ 1
;111 2
}22 
entry44 
.44 
Entity44 
.44 
LastModifiedBy44 +
=44, -
_user44. 3
.443 4
Id444 6
;446 7
entry55 
.55 
Entity55 
.55 
LastModified55 )
=55* +
utcNow55, 2
;552 3
}66 
}77 	
}88 
}99 
public;; 
static;; 
class;; 

Extensions;; 
{<< 
public== 

static== 
bool== #
HasChangedOwnedEntities== .
(==. /
this==/ 3
EntityEntry==4 ?
entry==@ E
)==E F
=>==G I
entry>> 
.>> 

References>> 
.>> 
Any>> 
(>> 
r>> 
=>>> !
r?? 
.?? 
TargetEntry?? 
!=?? 
null?? !
&&??" $
r@@ 
.@@ 
TargetEntry@@ 
.@@ 
Metadata@@ "
.@@" #
IsOwned@@# *
(@@* +
)@@+ ,
&&@@- /
(AA 
rAA 
.AA 
TargetEntryAA 
.AA 
StateAA  
==AA! #
EntityStateAA$ /
.AA/ 0
AddedAA0 5
||AA6 8
rAA9 :
.AA: ;
TargetEntryAA; F
.AAF G
StateAAG L
==AAM O
EntityStateAAP [
.AA[ \
ModifiedAA\ d
)AAd e
)AAe f
;AAf g
}BB æ	
z/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Data/Configurations/TodoListConfiguration.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Data# '
.' (
Configurations( 6
;6 7
public 
class !
TodoListConfiguration "
:# $$
IEntityTypeConfiguration% =
<= >
TodoList> F
>F G
{ 
public		 

void		 
	Configure		 
(		 
EntityTypeBuilder		 +
<		+ ,
TodoList		, 4
>		4 5
builder		6 =
)		= >
{

 
builder 
. 
Property 
( 
t 
=> 
t 
.  
Title  %
)% &
. 
HasMaxLength 
( 
$num 
) 
. 

IsRequired 
( 
) 
; 
builder 
. 
OwnsOne 
( 
b 
=> 
b 
. 
Colour "
)" #
;# $
} 
} ¯
z/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Data/Configurations/TodoItemConfiguration.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Data# '
.' (
Configurations( 6
;6 7
public 
class !
TodoItemConfiguration "
:# $$
IEntityTypeConfiguration% =
<= >
TodoItem> F
>F G
{ 
public		 

void		 
	Configure		 
(		 
EntityTypeBuilder		 +
<		+ ,
TodoItem		, 4
>		4 5
builder		6 =
)		= >
{

 
builder 
. 
Property 
( 
t 
=> 
t 
.  
Title  %
)% &
. 
HasMaxLength 
( 
$num 
) 
. 

IsRequired 
( 
) 
; 
} 
} <
u/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Data/ApplicationDbContextInitialiser.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Data# '
;' (
public 
static 
class !
InitialiserExtensions )
{ 
public 

static 
async 
Task #
InitialiseDatabaseAsync 4
(4 5
this5 9
WebApplication: H
appI L
)L M
{ 
using 
var 
scope 
= 
app 
. 
Services &
.& '
CreateScope' 2
(2 3
)3 4
;4 5
var 
initialiser 
= 
scope 
.  
ServiceProvider  /
./ 0
GetRequiredService0 B
<B C+
ApplicationDbContextInitialiserC b
>b c
(c d
)d e
;e f
await 
initialiser 
. 
InitialiseAsync )
() *
)* +
;+ ,
await 
initialiser 
. 
	SeedAsync #
(# $
)$ %
;% &
} 
} 
public 
class +
ApplicationDbContextInitialiser ,
{ 
private 
readonly 
ILogger 
< +
ApplicationDbContextInitialiser <
>< =
_logger> E
;E F
private 
readonly  
ApplicationDbContext )
_context* 2
;2 3
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private   
readonly   
RoleManager    
<    !
IdentityRole  ! -
>  - .
_roleManager  / ;
;  ; <
public"" 
+
ApplicationDbContextInitialiser"" *
(""* +
ILogger""+ 2
<""2 3+
ApplicationDbContextInitialiser""3 R
>""R S
logger""T Z
,""Z [ 
ApplicationDbContext## 
context## $
,##$ %
UserManager##& 1
<##1 2
ApplicationUser##2 A
>##A B
userManager##C N
,##N O
RoleManager##P [
<##[ \
IdentityRole##\ h
>##h i
roleManager##j u
)##u v
{$$ 
_logger%% 
=%% 
logger%% 
;%% 
_context&& 
=&& 
context&& 
;&& 
_userManager'' 
='' 
userManager'' "
;''" #
_roleManager(( 
=(( 
roleManager(( "
;((" #
})) 
public++ 

async++ 
Task++ 
InitialiseAsync++ %
(++% &
)++& '
{,, 
try-- 
{.. 	
await// 
_context// 
.// 
Database// #
.//# $
MigrateAsync//$ 0
(//0 1
)//1 2
;//2 3
}00 	
catch11 
(11 
	Exception11 
ex11 
)11 
{22 	
_logger33 
.33 
LogError33 
(33 
ex33 
,33  
$str33! U
)33U V
;33V W
throw44 
;44 
}55 	
}66 
public88 

async88 
Task88 
	SeedAsync88 
(88  
)88  !
{99 
try:: 
{;; 	
await<< 
TrySeedAsync<< 
(<< 
)<<  
;<<  !
}== 	
catch>> 
(>> 
	Exception>> 
ex>> 
)>> 
{?? 	
_logger@@ 
.@@ 
LogError@@ 
(@@ 
ex@@ 
,@@  
$str@@! P
)@@P Q
;@@Q R
throwAA 
;AA 
}BB 	
}CC 
publicEE 

asyncEE 
TaskEE 
TrySeedAsyncEE "
(EE" #
)EE# $
{FF 
varHH 
administratorRoleHH 
=HH 
newHH  #
IdentityRoleHH$ 0
(HH0 1
RolesHH1 6
.HH6 7
AdministratorHH7 D
)HHD E
;HHE F
ifJJ 

(JJ 
_roleManagerJJ 
.JJ 
RolesJJ 
.JJ 
AllJJ "
(JJ" #
rJJ# $
=>JJ% '
rJJ( )
.JJ) *
NameJJ* .
!=JJ/ 1
administratorRoleJJ2 C
.JJC D
NameJJD H
)JJH I
)JJI J
{KK 	
awaitLL 
_roleManagerLL 
.LL 
CreateAsyncLL *
(LL* +
administratorRoleLL+ <
)LL< =
;LL= >
}MM 	
varPP 
administratorPP 
=PP 
newPP 
ApplicationUserPP  /
{QQ 
UserNameQQ 
=QQ 
$strQQ 2
,QQ2 3
EmailQQ4 9
=QQ: ;
$strQQ< U
}QQV W
;QQW X
ifSS 

(SS 
_userManagerSS 
.SS 
UsersSS 
.SS 
AllSS "
(SS" #
uSS# $
=>SS% '
uSS( )
.SS) *
UserNameSS* 2
!=SS3 5
administratorSS6 C
.SSC D
UserNameSSD L
)SSL M
)SSM N
{TT 	
awaitUU 
_userManagerUU 
.UU 
CreateAsyncUU *
(UU* +
administratorUU+ 8
,UU8 9
$strUU: K
)UUK L
;UUL M
ifVV 
(VV 
!VV 
stringVV 
.VV 
IsNullOrWhiteSpaceVV *
(VV* +
administratorRoleVV+ <
.VV< =
NameVV= A
)VVA B
)VVB C
{WW 
awaitXX 
_userManagerXX "
.XX" #
AddToRolesAsyncXX# 2
(XX2 3
administratorXX3 @
,XX@ A
newXXB E
[XXE F
]XXF G
{XXH I
administratorRoleXXJ [
.XX[ \
NameXX\ `
}XXa b
)XXb c
;XXc d
}YY 
}ZZ 	
if^^ 

(^^ 
!^^ 
_context^^ 
.^^ 
	TodoLists^^ 
.^^  
Any^^  #
(^^# $
)^^$ %
)^^% &
{__ 	
_context`` 
.`` 
	TodoLists`` 
.`` 
Add`` "
(``" #
new``# &
TodoList``' /
{aa 
Titlebb 
=bb 
$strbb #
,bb# $
Itemscc 
=cc 
{dd 
newee 
TodoItemee  
{ee! "
Titleee# (
=ee) *
$stree+ @
}eeA B
,eeB C
newff 
TodoItemff  
{ff! "
Titleff# (
=ff) *
$strff+ G
}ffH I
,ffI J
newgg 
TodoItemgg  
{gg! "
Titlegg# (
=gg) *
$strgg+ c
}ggd e
,gge f
newhh 
TodoItemhh  
{hh! "
Titlehh# (
=hh) *
$strhh+ U
}hhV W
,hhW X
}ii 
}jj 
)jj 
;jj 
awaitll 
_contextll 
.ll 
SaveChangesAsyncll +
(ll+ ,
)ll, -
;ll- .
}mm 	
}nn 
}oo º
j/Users/re/Documents/projects/sonartest/SonarTest/SonarTest/src/Infrastructure/Data/ApplicationDbContext.cs
	namespace 	
	SonarTest
 
. 
Infrastructure "
." #
Data# '
;' (
public

 
class

  
ApplicationDbContext

 !
:

" #
IdentityDbContext

$ 5
<

5 6
ApplicationUser

6 E
>

E F
,

F G!
IApplicationDbContext

H ]
{ 
public 
 
ApplicationDbContext 
(  
DbContextOptions  0
<0 1 
ApplicationDbContext1 E
>E F
optionsG N
)N O
:P Q
baseR V
(V W
optionsW ^
)^ _
{ 
} 
public 

DbSet 
< 
TodoList 
> 
	TodoLists $
=>% '
Set( +
<+ ,
TodoList, 4
>4 5
(5 6
)6 7
;7 8
public 

DbSet 
< 
TodoItem 
> 
	TodoItems $
=>% '
Set( +
<+ ,
TodoItem, 4
>4 5
(5 6
)6 7
;7 8
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
builder9 @
)@ A
{ 
base 
. 
OnModelCreating 
( 
builder $
)$ %
;% &
builder 
. +
ApplyConfigurationsFromAssembly /
(/ 0
Assembly0 8
.8 9 
GetExecutingAssembly9 M
(M N
)N O
)O P
;P Q
} 
} 